<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Tutorial | Scrut</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://internalfb.com/scrut/docs/tutorial/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tutorial | Scrut"><meta data-rh="true" name="description" content="A walkthrough of Scrut use from start to end. For in-depth information: follow the white rabbit inline links."><meta data-rh="true" property="og:description" content="A walkthrough of Scrut use from start to end. For in-depth information: follow the white rabbit inline links."><link data-rh="true" rel="icon" href="/scrut/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://internalfb.com/scrut/docs/tutorial/"><link data-rh="true" rel="alternate" href="https://internalfb.com/scrut/docs/tutorial/" hreflang="en"><link data-rh="true" rel="alternate" href="https://internalfb.com/scrut/docs/tutorial/" hreflang="x-default"><link rel="stylesheet" href="/scrut/assets/css/styles.f264b72a.css">
<script src="/scrut/assets/js/runtime~main.0c772d5c.js" defer="defer"></script>
<script src="/scrut/assets/js/main.ad5510eb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/scrut/"><div class="navbar__logo"><img src="/scrut/img/logo.svg" alt="Scrut Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/scrut/img/logo.svg" alt="Scrut Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Scrut</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/scrut/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/scrut" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/scrut/docs/">Scrut</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/scrut/docs/tutorial/">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/scrut/docs/advanced/file-formats/">Advanced Topics</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/scrut/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tutorial</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tutorial</h1></header>
<p>A walkthrough of Scrut use from start to end. For in-depth information: follow the <del>white rabbit</del> inline links.</p>
<blockquote>
<p>The beginning is perhaps more difficult than anything else, but keep heart, it will turn out all right. - <em>Vincent van Gogh</em></p>
</blockquote>
<p>This guide is written with the following target audiences in mind:</p>
<ol>
<li><strong>CLI owners / contributors</strong>, that care about the quality of a specific CLI and therefore want to<!-- -->
<ul>
<li>Prove the behavior of the CLI in the form of integration / end-to-end tests tests</li>
<li>Document the CLI behavior for themselves of future developers of the CLI</li>
</ul>
</li>
<li><strong>System administrators / operators</strong>, that care about the CLI tools they work with and need to<!-- -->
<ul>
<li>Establish understanding and verify assumptions about their CLI tools</li>
<li>Document behavior of their CLI tools for themselves or future generations</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h2>
<p>To make it very simple to follow along, this guide uses the modern, but well established <a href="https://github.com/jqlang/jq" target="_blank" rel="noopener noreferrer"><code>jq</code></a> command line tool as the CLI that is tested in all provided code examples. Deep understanding of <code>jq</code> is not required, but it would help if you have at least some grasp what it does and how to use it. If that is not the case, yet: it is a truly, amazingly useful tool; now is a great time to learn about!</p>
<p>The following should work on your terminal:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># scrut itself should be installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scrut 0.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># jq should be installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jq-1.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Note</strong>: In all shell code blocks within this document lines prefixed with <code>$ </code> are commands, lines prefixed with <code># </code> are comments and any other line can be assumed to be the output of the previous command</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="about-file-structure">About file structure<a href="#about-file-structure" class="hash-link" aria-label="Direct link to About file structure" title="Direct link to About file structure">â€‹</a></h3>
<p>Scrut does not require any particular file structure. This tutorial is assuming that the files would be stored in a <code>integration-tests</code> subdirectory together with the source-code of the CLI that is tested.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># going to the directory that contains the source code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/Projects/jq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># creating a new directory that is going to contain the tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir integration-tests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Although Scrut has no requirements towards file structure it is recommended, that all test relating files (see more below) are in the same directory as the test files themselves, which makes referencing them easier.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decide-what-to-test-first">Decide what to test first<a href="#decide-what-to-test-first" class="hash-link" aria-label="Direct link to Decide what to test first" title="Direct link to Decide what to test first">â€‹</a></h2>
<p>What then is the first thing to test about our CLI <code>jq</code>? What is the first thing to test about any CLI? Maybe you have a great answer that fits perfectly for your specific CLI. If you don&#x27;t then consider to start with a <a href="https://en.wikipedia.org/wiki/Smoke_testing_(software)" target="_blank" rel="noopener noreferrer">smoke test</a>: <em>When I switch it on, do I see smoke rising up?</em></p>
<p>Translated to a CLI that means: executing the tool in the most basic way possible, does it panic / fatal / die unexpectedly? Considering you keep developing your CLI, such a basic test answers the question: <em>Did you break something very fundamental?</em></p>
<p>And what would be a good smoke test for a CLI? For <code>jq</code> it is the execution from above (<code>jq --version</code>) seems like a great candidate. For other CLIs it might be <code>--help</code> instead. Either way, you want to choose something that doesn&#x27;t have much complexity, that doesn&#x27;t rely on any external dependencies. If you are the author of the CLI that should be easy to find.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-automatic-test-creation">Pattern: Automatic Test Creation<a href="#pattern-automatic-test-creation" class="hash-link" aria-label="Direct link to Pattern: Automatic Test Creation" title="Direct link to Pattern: Automatic Test Creation">â€‹</a></h2>
<p>Finally, let&#x27;s get to writing the test. Actually writing seems too bothersome. Sure, you could, but how about you generate it instead? Do that:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut create --output integration-tests/smoke.md -- jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing generated test to `integration-tests/smoke.md`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ok, let me unpack that for you:</p>
<ul>
<li><code>scrut create</code> - tells Scrut to execute a command and create a test from its output</li>
<li><code>--output integration-tests/smoke.md</code> - lets <code>scrut</code> know where to write the created test to</li>
<li><code>--</code> - signifies the end of options for scrut; all that follows is part of the command for which a test is generated</li>
<li><code>jq --version</code> - that is the command (the <em>Shell Expression</em>) which <code>scrut</code> is going to execute and from which&#x27;s output it is going to generate test <em>Expectations</em></li>
</ul>
<p>This also could have been written differently:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo &quot;jq --version&quot; | scrut create - &gt; integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing generated test to STDOUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here the string <code>jq --version</code> was piped to the STDIN of <code>scrut create</code> (which was made aware of that by having one argument <code>-</code>) and the output (to STDOUT) was delegated into the same output file as before.</p>
<p>Both are valid forms and result in the same outcome, that is a new test in the file <code>integration-tests/smoke.md</code>. The contents of that file should be like that (aside from the version string, that is likely different for you):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Command executes successfully</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">jq-1.6</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While you are looking at it, how about you change that title to <code>Smoke test</code> or something like that. <strong>Half of the value of a Scrut test file is the documentation, so it is always worth to put in some time to clarify intentions and describe expectations</strong>.</p>
<p>Don&#x27;t touch the rest - for now. We&#x27;ll get to that in a minute. You can read up on the <a href="/scrut/docs/advanced/file-formats/#file-anatomy">anatomy of the file</a>, here a very quick primer:</p>
<ul>
<li>Scrut test files are <a href="/scrut/docs/advanced/file-formats/#markdown-format">markdown documents</a></li>
<li>Code blocks of language <code>scrut</code> contain the tested commands and the expected output</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-first-test">Run the first Test<a href="#run-the-first-test" class="hash-link" aria-label="Direct link to Run the first Test" title="Direct link to Run the first Test">â€‹</a></h3>
<p>Running tests is the bread and butter of Scrut. It is - literally - what it is made for. So without further ado:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut test integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validation succeeded</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Nice! That works. As it should be, since Scrut create the test for you. Although that was a bit anticlimactic. Let&#x27;s make it more fun and go break it ðŸ¤¡. Change the contents of the file like so:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Smoke test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">foo</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now run it again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut test integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @ integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// # Smoke test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// $ jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1     | - foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1  | + jq-1.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ok, it is getting interesting. What you are seeing here (likely in color) is an output validation error. The output expectations in the test file do not match with the output the command actually spits out. This is how you read it:</p>
<ul>
<li><code>@ integration-tests/smoke.md</code>: Location of the test file</li>
<li><code># Smoke test</code>: Title of the test in the file</li>
<li><code>$ task --version</code>: Shell expression that resulted in invalid output</li>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1     | - foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1  | + jq-1.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->The first line <code>1 | - foo</code> denotes that <code>foo</code> was expected from the test, but is missing in the output. The next line <code>1 | + jq-1.6</code> denotes that <code>jq-1.6</code> was printed out as 1st line from the command, but is missing in the test.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-resilient-tests">Pattern: Resilient Tests<a href="#pattern-resilient-tests" class="hash-link" aria-label="Direct link to Pattern: Resilient Tests" title="Direct link to Pattern: Resilient Tests">â€‹</a></h2>
<p>This is actually a good point in time to speak about brittle tests. Having the version (here <code>jq-1.6</code>) in the <code>smoke.md</code> file is not a good idea. Why? Because it is likely to change, because you keep developing it. Or someone is. Having that string in the test file will just create the worst kind of all work down the line: toil.</p>
<p>Also consider: Does having the version in there really provide value? The idea of the smoke test is to fail if things are so broken, that basically nothing works anymore. From that perspective, there is no need to check about the version: let&#x27;s get rid of this nascent technical debt.</p>
<p>So how do you do that? Well, how would you do it on the shell? You would do something like that:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ jq --version &gt; /dev/null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And that is exactly how you would do it in the test:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Smoke test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ jq --version &gt; /dev/null</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Is that still a meaningful test? Yes, it is! It still tests whether the command executes successfully. What does successfully mean? Well, whether it exits with a <code>0</code> exit code. <em>That is an implicit test any test case will automatically provide</em>. Don&#x27;t take my word for it, though. Change the expected exit code to, say, <code>10</code> and see what happens. Just add a new line containing <code>[10]</code> after the shell expression:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Smoke test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ jq --version &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">[10]</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now test it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut test integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @ integration-tests/smoke.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// # Smoke test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// $ jq --version &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unexpected exit code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expected: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  actual:   0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## STDOUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## STDERR</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As promised: it fails. The output should be self explanatory. Read more about <a href="/scrut/docs/advanced/specifics/#exit-codes">exit codes here</a>.</p>
<p>Going forward remove the <code>[10]</code> again, so that the test is in a working state.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-test-fixtures">Pattern: Test Fixtures<a href="#pattern-test-fixtures" class="hash-link" aria-label="Direct link to Pattern: Test Fixtures" title="Direct link to Pattern: Test Fixtures">â€‹</a></h2>
<p>Ok, let&#x27;s start with testing actual functionality. No worries, we won&#x27;t attempt to cover all that <code>jq</code> can do with tests in this tutorial. Just enough to show some good to know patterns. Here is one, if a bit obvious: a good idea to start with any test is executing it on the shell.</p>
<p>Since <code>jq</code> is a neat tool to manipulate JSON, we need some JSON to manipulate. Let&#x27;s use the <a href="https://jqlang.github.io/jq/tutorial/" target="_blank" rel="noopener noreferrer">same as the <code>jq</code> tutorial itself</a>, that is the Github history of <a href="https://github.com/jqlang/jq" target="_blank" rel="noopener noreferrer">the <code>jq</code> repository</a>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># not gonna show the output, it is a lot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s say we want to write a test that proves and documents the (imho) core functionality of <code>jq</code>: mutating JSON. As an example we are going to reduce those huge JSON dumps into something more manageable: <em>who&#x27;s commit was committed when</em>. Each result item should have the following form: <code>{&quot;who&quot;: &quot;&lt;name&gt;&quot;, &quot;when&quot;: &quot;&lt;date&gt;&quot;} </code>. This is how you can achieve that on the the command line (names changed):</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  jq &#x27;[.[] | {who: .commit.author.name, when: .commit.committer.date}]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;who&quot;: &quot;Person Name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;when&quot;: &quot;2022-05-26T21:04:32Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;who&quot;: &quot;Another Person&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;when&quot;: &quot;2022-05-26T21:02:50Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;who&quot;: &quot;Even More&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;when&quot;: &quot;2022-05-26T21:02:10Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;who&quot;: &quot;And so forth&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;when&quot;: &quot;2022-05-26T21:01:25Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;who&quot;: &quot;Name Name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;when&quot;: &quot;2022-05-26T20:53:59Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ok, that shows that the transformation of the output works as we assumed it would. However, you probably have noted, using the <code>curl</code> output in the a test will not be very resilient, as the output is prone to change.</p>
<p>Since we are not really interested in the functionality of <code>curl</code> or Github (and quite frankly could without network dependencies), let&#x27;s instead store the current output of the <code>curl</code> execution into a <em>test fixture file</em> in our <code>integration-tests</code> folder. This way we have a consistent input to run our test on:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; &gt; integration-tests/commits.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can start with writing the actual test file. Instead of using <code>scrut create</code>, start with the following template in <code>integration-tests/transform-input.md</code>:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Transform input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ cat &quot;$TESTDIR/commits.json&quot; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;[.[] | {who: .commit.author.name, when: .commit.committer.date}]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Person Name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:04:32Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Another Person&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:02:50Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Even More&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:02:10Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;And so forth&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:01:25Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Name Name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T20:53:59Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">]</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Note</strong>: The second (and any subsequent) line of a command starts with a <code>&gt;</code> character - unlike the first, which starts with a <code>$</code> (<a href="/scrut/docs/advanced/file-formats/#markdown-format">read more</a>). The tailing <code>\\</code> in the first command line is needed, because <code>/bin/bash</code> needs it (both lines, stripped by their starting <code>$</code> or <code>&gt;</code> character, are ultimately passed to the shell process, hence must comply with it&#x27;s requirements).</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tests-directory-isolation">Tests directory isolation<a href="#tests-directory-isolation" class="hash-link" aria-label="Direct link to Tests directory isolation" title="Direct link to Tests directory isolation">â€‹</a></h3>
<p>You may have noted the that the <code>commits.json</code> file is referred to as <code>&quot;$TESTDIR/commits.json&quot;</code>. The reason for that is that each test is executed from within an empty test directory. The absolute path to the directory, where the actual test file is in is available via the <code>$TESTDIR</code> environment variable. Since <code>commits.json</code> is located in the same directory as <code>transform-input.md</code> the expression <code>&quot;$TESTDIR/commits.json&quot;</code> contains the absolute path to the <code>commits.json</code> file (<a href="/scrut/docs/advanced/specifics/#test-environment-variables">read more</a>).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-test-bootstrapping">Pattern: Test Bootstrapping<a href="#pattern-test-bootstrapping" class="hash-link" aria-label="Direct link to Pattern: Test Bootstrapping" title="Direct link to Pattern: Test Bootstrapping">â€‹</a></h2>
<p>There is one more thing that should be done to make the test resilient: <code>jq</code> has a couple of command line parameters that decide how the output is being rendered. There are two in particular, which should be set in our case:</p>
<ul>
<li><code>-r</code> (raw output): Pertains to non-JSON output, in which strings would be quoted without it (let&#x27;s not - easier to pipe into other command line programs)</li>
<li><code>-M</code> (monochrome, not colored output): While that is currently the default, it may change which would break our test</li>
<li><code>-S</code> (sort keys of objects): Currently, the keys are outputted as we provided them - but to be safe (have a resilient test), lets just explicitly sort them, then there is no question in their order</li>
</ul>
<p>Using both of those keys would change the command in the <code>jq &lt;..&gt;</code> command in the test to <code>jq -r -M -S &lt;..&gt;</code>.</p>
<p>Thinking ahead, we are going to use these flags in <em>every test</em>, for the same reason why we are using it here (be very sure about the expected output). With that in mind, consider the following bash script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># tell bash exporting aliases is fine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shopt -s expand_aliases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># alias `jq`, so that it always executes with the two parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias jq=&#x27;jq -r -M -S&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Store the above file under <code>integration-tests/setup.sh</code>, and then we can make use of it in our test file:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Test transformation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test whether </span><span class="token code-snippet code keyword" style="color:#00009f">`jq`</span><span class="token plain"> transforms tests as we</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Bootstrap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block">$ source &quot;$TESTDIR/setup.sh&quot;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Transform input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ cat &quot;$TESTDIR&quot;/commits.json | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;[.[] | {who: .commit.author.name, when: .commit.committer.date}]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:04:32Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Person Name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:02:50Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Another Person&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:02:10Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Even More&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T21:01:25Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;And so forth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;when&quot;: &quot;2022-05-26T20:53:59Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">    &quot;who&quot;: &quot;Name Name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">]</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Note</strong>: The order of <code>who</code> and <code>when</code> changed due to <code>-S</code>.</p>
</blockquote>
<p>As you can see there are now two code blocks of the type <code>scrut</code> in the same file. That means there are two tests in that one file. This is fine, you can have <a href="/scrut/docs/advanced/file-formats/#file-anatomy">as many test as make sense to you in a file</a>. Scrut <a href="/scrut/docs/advanced/specifics/#test-execution">executes them in order</a>, which allows the <code>alias jq=..</code> set in <code>setup.sh</code> to affect the <code>jq</code> execution in the test file.</p>
<p><strong>Bootstrapping tests is a very common strategy in Scrut</strong> and is considered idiomatic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bootstrapping-sounds-familiar">Bootstrapping, sounds familiar?<a href="#bootstrapping-sounds-familiar" class="hash-link" aria-label="Direct link to Bootstrapping, sounds familiar?" title="Direct link to Bootstrapping, sounds familiar?">â€‹</a></h3>
<p>If you are familiar with unit testing (in whatever language), you likely came across the <a href="https://en.wikipedia.org/wiki/Test_suite" target="_blank" rel="noopener noreferrer">test suite pattern</a>. If not, then in (very) short: A test suite is a semantic cohesive collection of tests, which is often run against different implementations of the same interface. Imagine a storage backend interface, for which an implementation <code>LocalStorage</code> writes on a local disk and <code>RemoteStorage</code> writes somewhere in the cloud. Both implement the same <code>Storage</code> interface and therefore can be tested by the same test suite <code>StorageTestSuite</code>.</p>
<p>In those scenarios it is not uncommon that each test-suite run executes specific &quot;setup code&quot; for each implementation, before all the tests are executed. You may often find methods named like <code>setupTests</code>, <code>beforeTests</code> or something akin.</p>
<p><strong>A variant of bootstrapping is seeding</strong> where a specific methods are executed once before <em>each</em> test (as oppose to: once before <em>all</em> tests). Although the terms may be also be used interchangeable (depends on the language of the testing framework and developer&#x27;s choice). Translated to Scrut you could have <code>seed-some-state.sh</code> files, that are then included in one or multiple tests, to keep the tests themselves clean and the code d.r.y.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-update-as-a-workflow">Pattern: Update as a Workflow<a href="#pattern-update-as-a-workflow" class="hash-link" aria-label="Direct link to Pattern: Update as a Workflow" title="Direct link to Pattern: Update as a Workflow">â€‹</a></h2>
<p>In the previous section quite a lot of copying from the terminal into text files happened. A tad bothersome and smells like a bad tedious process. Indeed. There is a better way.</p>
<p>Let&#x27;s start with a new test. <code>jq</code> has <a href="https://jqlang.github.io/jq/manual/#Builtinoperatorsandfunctions" target="_blank" rel="noopener noreferrer">a lot of built-in functions</a>, so there is plenty to pick from. Since we were already interested in that committer date earlier, lets write a test for the <code>fromdate</code> function. Start with the following template, which is basically a copy of the previous test, but with the new command we want and with all outputs striped:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Test built-in `fromdate`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Assure the </span><span class="token code-snippet code keyword" style="color:#00009f">`fromdate`</span><span class="token plain"> function parses ISO 8601 dates into unix timestamps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Bootstrap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ source &quot;$TESTDIR/setup.sh&quot;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Use `fromdate`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ cat &quot;$TESTDIR&quot;/commits.json | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.committer.date | fromdate&#x27;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Having clear intentions in the leading markdown of a test file is a good practice</strong>. Here it makes it clear that we are expecting the output of some unix timestamps. Since we don&#x27;t have any, it is to be expected that the test execution will fail. Only one way to be sure:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut test integration-tests/builtin-fromdate.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @ integration-tests/builtin-fromdate.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// # Use `fromdate`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// $ cat &quot;$TESTDIR&quot;/commits.json | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   jq &#x27;.[] | .commit.committer.date | fromdate&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// =============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1  | + 1653599072</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2  | + 1653598970</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3  | + 1653598930</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4  | + 1653598885</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   5  | + 1653598439</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This output tells us two things:</p>
<ol>
<li>It seems <code>fromdate</code> can parse our dates and transform them into unix timestamps</li>
<li>The test fails, because it does not mention the expected output</li>
</ol>
<p>At least the latter is not completely surprising. In order to make the test green, we could again copy the output into the test. However, there is a better way - as promised:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ scrut update --replace integration-tests/builtin-fromdate.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This shows you the same failed test output again. However, in addition it ends in a prompt that asks you whether the test file should be overwritten:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Overwrite existing file `integration-tests/builtin-fromdate.md`?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Hit <code>y</code> here, which will cause <code>scrut</code> to update your test and add the missing output lines after the command for you.</p>
<p><strong>Writing tests and using update to fill in the outputs is good practice</strong> for creating new tests and also for maintain existing ones: Imagine you fix a typo in the command output. Run <code>scrut update &lt;file&gt;</code> to fix the test. Does the typo change a lot of tests? Run <code>scrut update &lt;directory&gt;</code> and be done.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="powerful-expectations">Powerful Expectations<a href="#powerful-expectations" class="hash-link" aria-label="Direct link to Powerful Expectations" title="Direct link to Powerful Expectations">â€‹</a></h2>
<p>Take a step back and consider the test cases we wrote so far - and compare them against real-live scenarios. One thing may peak out you: Using a the <code>commits.json</code> file as a test fixture is a neat way to assure that we always work on the same input data. However, especially in the end-2-end testing space, things are not always possible. Things are not as neat and tidy.</p>
<p>Leave the idea of testing the functionality of <code>jq</code> for a moment behind, so you can think about writing tests for situations where the data your tests run on is outside of your control.</p>
<p>Let&#x27;s revisit our <code>transform-input.md</code> test file from before. Copy it into <code>transform-input-live.md</code> and change in that new file the command into the following:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.author.name + &quot;;&quot; + .commit.committer.date&#x27;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means: we are back to using the live data (to simulate &quot;dirty&quot; / unpredictable data). Also the output is no longer JSON, but a single line string per commit with the format <code>&lt;name&gt;;&lt;date&gt;</code>.</p>
<p>First, run <code>scrut update</code> on it and overwrite the contents. The modified <code>transform-input-live.md</code> file should look something like that (with different names and dates):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Test transformation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Bootstrap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ source &quot;$TESTDIR/setup.sh&quot;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Transform input from live data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.author.name + &quot;;&quot; + .commit.committer.date&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">Person Name;2022-05-26T21:04:32Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">Another Person;2022-05-26T21:02:50Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">Even More;2022-05-26T21:02:10Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">And so forth;2022-05-26T21:01:25Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">Name Name;2022-05-26T20:53:59Z</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We already established, that having this specific content in there is brittle and will cause headache down the line. So where is this going?</p>
<p>At this point it becomes necessary to understand that each of the output lines in the test are actually <a href="/scrut/docs/advanced/expectations/">output expectations</a>. The last line of the above output could also be written as:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name Name;2022-05-26T20:53:59Z (equal)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The tailing <code> (equal)</code> is the <em>type</em>, telling Scrut that this is, well, an expectation which should match exactly the provided expression (like the <code>==</code> equal operator). Since those are the most common ones, and it is so much more readable to <em>not</em> have <code>(equal)</code> everywhere, you can omit it. However, this the only expectation that allows you to omit the type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="glob">Glob<a href="#glob" class="hash-link" aria-label="Direct link to Glob" title="Direct link to Glob">â€‹</a></h3>
<p>Scrut has two expectation types that would work here. Lets start with simpler one, that is powerful, but not very precise, though easy to write and read. It is the <a href="/scrut/docs/advanced/expectations/#glob-expectation">glob expectation</a>. Consider the following:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Transform input from live data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.author.name + &quot;;&quot; + .commit.committer.date&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Without going <a href="/scrut/docs/advanced/expectations/#glob-expectation">into full detail</a>, glob supports two wildcard characters <code>*</code> for any amount of any character and <code>?</code> for a single arbitrary character. Each of the above expectations translates to:</p>
<ul>
<li>Any string that is followed by <code>;20</code></li>
<li>Followed by anything</li>
<li>Ending in <code>Z</code></li>
</ul>
<blockquote>
<p><strong>Note</strong>: <em>anything</em> means anything <em>but</em> a newline character</p>
</blockquote>
<p>Using the glob expectation like this should cover about any possible output - at least until the year 2100. There should be little maintenance in the short- to midterm. That is reasonable resilient - but rather imprecise.</p>
<p>On that note: As you can see, we repeated the same expectation five times. <strong>Each line of output must have a matching expectation or the test fails</strong>. That also means: Having exactly five expectations is a test in itself, which would fail for zero or four or six lines of outputs equally.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="regular-expression">Regular expression<a href="#regular-expression" class="hash-link" aria-label="Direct link to Regular expression" title="Direct link to Regular expression">â€‹</a></h3>
<p>The above headline bestows fear in many and delight in some. So it is up to you to read this paragraph or skip it entirely. If you are not familiar with regular expressions, maybe you take this as an opportunity to learn about them - although this is way beyond the scope of this how-to.</p>
<p>Lets jump right into it then: <code>scrut</code> supports <a href="/scrut/docs/advanced/expectations/#regex-expectation">regular expression expectations</a> with the <code> (regex)</code> type. Rewriting the test from above could look like that (well, one variant):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Transform input from live data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.author.name + &quot;;&quot; + .commit.committer.date&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">\w+(?:\s\w+)*;\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}Z (regex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">\w+(?:\s\w+)*;\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}Z (regex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">\w+(?:\s\w+)*;\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}Z (regex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">\w+(?:\s\w+)*;\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}Z (regex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">\w+(?:\s+\w+)*;\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}Z (regex)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is much more precise than the above glob expectation - at the cost of readability. There is room for error, that likely won&#x27;t capture all possible name writings (e.g. <code>Forename M. Surname</code> would fail) - feel free to optimize.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quantifiers">Quantifiers<a href="#quantifiers" class="hash-link" aria-label="Direct link to Quantifiers" title="Direct link to Quantifiers">â€‹</a></h3>
<p>A last, but extremely useful feature - especially when testing multiple lines of similar formed output - are <em>Quantifiers</em>.</p>
<p>Consider the <code>curl</code> query from above. It ends in <code>?per_page=5</code>, which indicates that we should expect <em>up to</em> five items - could be less, though. A different valid scenario would be too much output. Imagine your CLI outputs, say, hundreds or even thousands of lines. That would make any test file unreadable, aka unmaintainable, for humans. A test that cannot be understood is equal to no test - maybe even worse.</p>
<p>So how would a test look that addresses those issues? Especially when knowing that <em>every output line</em> must be covered by an expectation? Enter the <em>expectation quantifier</em>, which allows you to define quantities for expectations. Consider this:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Transform input from live data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">scrut</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-scrut">$ curl &#x27;https://api.github.com/repos/jqlang/jq/commits?per_page=5&#x27; | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">&gt; jq &#x27;.[] | .commit.author.name + &quot;;&quot; + .commit.committer.date&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-scrut">*;20*Z (glob+)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note the <code>+</code> symbol after the <code>glob</code> word. That is a quantifier. <a href="/scrut/docs/advanced/expectations/#quantifiers">Read more about them here</a>. Suffice to say that there are three (<code>?</code> = optional, <code>*</code> = 0 or more, <code>+</code> = 1 or more). Meaning, this single line covers all the possible output lines that match this form.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-structure-by-use-case">Pattern: Structure by use-case<a href="#pattern-structure-by-use-case" class="hash-link" aria-label="Direct link to Pattern: Structure by use-case" title="Direct link to Pattern: Structure by use-case">â€‹</a></h2>
<p>This tutorial already talked about how to structure tests inside a file (having bootstrapping at the top, followed by the actual tests). As a last topic let&#x27;s talk for a minute about how to structure test files (within folders).</p>
<p>As noted at the start of this document, Scrut can be very useful for CLI owners and system administrators alike. The former may concentrate on testing and documenting a single CLI. The latter may concentrate on testing and documenting the interplay of multiple command line tools at once, maybe the process of a runbook, or a specific operation to recover a database or something like that.</p>
<p>Either way <strong>it is good practice to isolate every use-case into a single file</strong>. That could be one test file per sub-command of the CLI that is tested or one test file per runbook that is tested. Whatever makes most sense. The purpose should be to gain the most information possible out of a failing test: <em>Test <code>A.md</code> is failing, but test <code>B.md</code> is not, that indicates that <code>feature X</code> is broken</em>.</p>
<p>For <code>jq</code> that could mean to write a single <a href="https://jqlang.github.io/jq/manual/#Builtinoperatorsandfunctions" target="_blank" rel="noopener noreferrer">file per function</a> <code>jq</code> exposes. However, if <code>jq</code> already has a unittest suite that covers each function, maybe it makes more sense to concentrate on testing <a href="https://jqlang.github.io/jq/manual/#IO" target="_blank" rel="noopener noreferrer">I/O</a> and also maybe whether <a href="https://jqlang.github.io/jq/manual/#Modules" target="_blank" rel="noopener noreferrer">modules</a> work as expected.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps">â€‹</a></h2>
<p>You did it. You are a <em>scrutacean</em> now (<a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">rust</a> developers are called <em>rustaceans</em>, scrut is build in rust, there you go). If you want, go ahead and write some additional tests for <code>jq</code>, or dig deeper into the rest of <a href="/scrut/docs/advanced/file-formats/">file formats</a>, <a href="/scrut/docs/advanced/expectations/">expectations</a> or  <a href="/scrut/docs/advanced/specifics/">behavioral specifics</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://www.internalfb.com/code/fbsource/fbcode/clifoundation/scrut/website/docs/tutorial.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/scrut/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scrut</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/scrut/docs/advanced/file-formats/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">File Formats</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#about-file-structure" class="table-of-contents__link toc-highlight">About file structure</a></li></ul></li><li><a href="#decide-what-to-test-first" class="table-of-contents__link toc-highlight">Decide what to test first</a></li><li><a href="#pattern-automatic-test-creation" class="table-of-contents__link toc-highlight">Pattern: Automatic Test Creation</a><ul><li><a href="#run-the-first-test" class="table-of-contents__link toc-highlight">Run the first Test</a></li></ul></li><li><a href="#pattern-resilient-tests" class="table-of-contents__link toc-highlight">Pattern: Resilient Tests</a></li><li><a href="#pattern-test-fixtures" class="table-of-contents__link toc-highlight">Pattern: Test Fixtures</a><ul><li><a href="#tests-directory-isolation" class="table-of-contents__link toc-highlight">Tests directory isolation</a></li></ul></li><li><a href="#pattern-test-bootstrapping" class="table-of-contents__link toc-highlight">Pattern: Test Bootstrapping</a><ul><li><a href="#bootstrapping-sounds-familiar" class="table-of-contents__link toc-highlight">Bootstrapping, sounds familiar?</a></li></ul></li><li><a href="#pattern-update-as-a-workflow" class="table-of-contents__link toc-highlight">Pattern: Update as a Workflow</a></li><li><a href="#powerful-expectations" class="table-of-contents__link toc-highlight">Powerful Expectations</a><ul><li><a href="#glob" class="table-of-contents__link toc-highlight">Glob</a></li><li><a href="#regular-expression" class="table-of-contents__link toc-highlight">Regular expression</a></li><li><a href="#quantifiers" class="table-of-contents__link toc-highlight">Quantifiers</a></li></ul></li><li><a href="#pattern-structure-by-use-case" class="table-of-contents__link toc-highlight">Pattern: Structure by use-case</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.fb.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use</a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Meta Platforms, Inc</div></div></div></footer></div>
</body>
</html>