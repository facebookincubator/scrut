"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[727],{3905:function(e,t,n){n.r(t),n.d(t,{MDXContext:function(){return m},MDXProvider:function(){return u},mdx:function(){return x},useMDXComponents:function(){return p},withMDXComponents:function(){return s}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m=a.createContext({}),s=function(e){return function(t){var n=p(t.components);return a.createElement(e,i({},t,{components:n}))}},p=function(e){var t=a.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(m.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=d(e,["components","mdxType","originalType","parentName"]),s=p(n),u=r,h=s["".concat(l,".").concat(u)]||s[u]||c[u]||i;return n?a.createElement(h,o(o({ref:t},m),{},{components:n})):a.createElement(h,o({ref:t},m))}));function x(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=h;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var m=2;m<i;m++)l[m]=n[m];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},272:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return d},default:function(){return c},frontMatter:function(){return o},metadata:function(){return m},toc:function(){return p}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),l=["components"],o={sidebar_position:1},d="File Formats",m={unversionedId:"advanced/file-formats",id:"advanced/file-formats",title:"File Formats",description:"Scrut supports multiple test file formats. The recommended format is Markdown.",source:"@site/docs/advanced/file-formats.md",sourceDirName:"advanced",slug:"/advanced/file-formats",permalink:"/scrut/docs/advanced/file-formats",draft:!1,editUrl:"https://www.internalfb.com/code/fbsource/fbcode/clifoundation/scrut/website/docs/advanced/file-formats.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Tutorial",permalink:"/scrut/docs/tutorial"},next:{title:"Expectations",permalink:"/scrut/docs/advanced/expectations"}},s={},p=[{value:"File Anatomy",id:"file-anatomy",level:2},{value:"Test Case Anatomy",id:"test-case-anatomy",level:3},{value:"Markdown Format",id:"markdown-format",level:2},{value:"Inline Configuration",id:"inline-configuration",level:3},{value:"Document Configuration",id:"document-configuration",level:4},{value:"TestCase Configuration",id:"testcase-configuration",level:4},{value:"Wait Configuration",id:"wait-configuration",level:3},{value:"Cram Format",id:"cram-format",level:2},{value:"Which format to chose?",id:"which-format-to-chose",level:2}],u={toc:p};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.mdx)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"file-formats"},"File Formats"),(0,i.mdx)("p",null,"Scrut supports multiple test file formats. The recommended format is ",(0,i.mdx)("a",{parentName:"p",href:"#markdown-format"},"Markdown"),"."),(0,i.mdx)("h2",{id:"file-anatomy"},"File Anatomy"),(0,i.mdx)("p",null,"All test files contain one or more test cases. There are two common patterns to structure test files in Scrut:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("strong",{parentName:"li"},"Coherent Test Suite")," (recommended): One test file represents one use-case or behavior. This makes it easy to identify broken functionality."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("strong",{parentName:"li"},"List of Tests"),": One test file contains a list of simple, not necessarily related tests.")),(0,i.mdx)("p",null,"Markdown files support ",(0,i.mdx)("a",{parentName:"p",href:"#inline-configuration"},"document wide configuration"),' in the form of "YAML Frontmatter".'),(0,i.mdx)("h3",{id:"test-case-anatomy"},"Test Case Anatomy"),(0,i.mdx)("p",null,"Each individual test that lives in a test file is called a ",(0,i.mdx)("em",{parentName:"p"},"Test Case")," and consists of the following components:"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},"A ",(0,i.mdx)("strong",{parentName:"li"},"Title"),", so that a human can understand what is being done"),(0,i.mdx)("li",{parentName:"ol"},"A ",(0,i.mdx)("strong",{parentName:"li"},"Shell Expression"),", that can be anything from a single command to a multi-line, multi-piped expression"),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("strong",{parentName:"li"},(0,i.mdx)("a",{parentName:"strong",href:"/scrut/docs/advanced/expectations"},"Expectations"))," of the output that the Shell Expression will yield"),(0,i.mdx)("li",{parentName:"ol"},"Optionally the expected ",(0,i.mdx)("em",{parentName:"li"},"Exit Code")," the Shell Expression must end in - if anything but successful execution (",(0,i.mdx)("inlineCode",{parentName:"li"},"0"),") is expected"),(0,i.mdx)("li",{parentName:"ol"},"Optionally per-test-case configuration (only supported by Markdown format)")),(0,i.mdx)("h2",{id:"markdown-format"},"Markdown Format"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"https://www.markdownguide.org/"},"Markdown")," is an amazingly simple, yet powerful language. To write ",(0,i.mdx)("em",{parentName:"p"},"Test Cases")," in Markdown follow this guidance:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("em",{parentName:"li"},"Shell Expressions")," and ",(0,i.mdx)("em",{parentName:"li"},"Expectations")," live in the same code-block, that must be annotated with the language ",(0,i.mdx)("inlineCode",{parentName:"li"},"scrut"),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},"The first line of a ",(0,i.mdx)("em",{parentName:"li"},"Shell Expressions")," must start with ",(0,i.mdx)("inlineCode",{parentName:"li"},"$ ")," (dollar, sign followed by a space), any subsequent with ",(0,i.mdx)("inlineCode",{parentName:"li"},"> ")," (closing angle bracket / chevron, followed by a space)"),(0,i.mdx)("li",{parentName:"ul"},"All other lines in the code block (including empty ones) that follow the ",(0,i.mdx)("em",{parentName:"li"},"Shell Expression")," are considered ",(0,i.mdx)("em",{parentName:"li"},"Expectations")),(0,i.mdx)("li",{parentName:"ul"},"Lines starting with ",(0,i.mdx)("inlineCode",{parentName:"li"},"#")," that precede the shell expression are ignored (comments)"),(0,i.mdx)("li",{parentName:"ul"},"If an ",(0,i.mdx)("em",{parentName:"li"},"Exit Code")," other than 0 is expected, it can be denoted in square brackets ",(0,i.mdx)("inlineCode",{parentName:"li"},"[123]")," once per ",(0,i.mdx)("em",{parentName:"li"},"Test Case")))),(0,i.mdx)("li",{parentName:"ul"},"The first line before the code block that is either a paragraph or a header will be used as the ",(0,i.mdx)("em",{parentName:"li"},"Title")," of the ",(0,i.mdx)("em",{parentName:"li"},"Test Case"))),(0,i.mdx)("p",null,"Here an example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-markdown"},"This is the title\n\n```scrut\n$ command | \\\n>   other-command\nexpected output line\nanother expected output line\n[123]\n```\n")),(0,i.mdx)("p",null,"The following ",(0,i.mdx)("strong",{parentName:"p"},"constraints")," apply:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"A markdown file can contain as many Test Cases as needed (1..n)"),(0,i.mdx)("li",{parentName:"ul"},"Each code block in a Test Case may only have ",(0,i.mdx)("em",{parentName:"li"},"one")," (1) Shell Expression (each Test Case is considered atomic)"),(0,i.mdx)("li",{parentName:"ul"},"Code blocks that do not denote a language (or a different language than ",(0,i.mdx)("inlineCode",{parentName:"li"},"scrut"),") will be ignored")),(0,i.mdx)("p",null,"With that in mind, consider the following markdown file that contains not only Test Cases but arbitrary other text and other code blocks. This is idiomatic Scrut markdown files that combines tests and documentation:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'# This is just regular markdown\n\nIt contains both Scrut tests **and**  abitrary text, including code examples,\nthat are unrelated to Scrut.\n\n```python\nimport os\n\nprint("This code block ignored by Scrut")\n```\n\n## Here is a scrut test\n\n```scrut\n$ echo Hello\nHello\n```\n\n## Embedded with other documentation\n\nSo it\'s a mix of test and not tests.\n\nAny amount of tests are fine:\n\n```scrut\n$ echo World\nWorld\n```\n\nJust make sure to write only one Test Case per code-block.\n')),(0,i.mdx)("blockquote",null,(0,i.mdx)("p",{parentName:"blockquote"},(0,i.mdx)("strong",{parentName:"p"},"Note"),": If you are testing actual markdown output, be aware that you can embed code blocks in other code blocks, if the outer code block uses one more backtick (opening and closing!) than the embedded one(s). Just have a look at the source code of this file right above this text.")),(0,i.mdx)("h3",{id:"inline-configuration"},"Inline Configuration"),(0,i.mdx)("p",null,"Scrut supports two kinds of inline configuration:"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("strong",{parentName:"li"},"Per Document")," (document-wide) configuration, which can be defined at the start of the test file"),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("strong",{parentName:"li"},"Per Test Case")," (test-case-wide) configuration, which can be defined with each individual Test Case")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Example")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-markdown"},"---\n# document-wide YAML configuration\ntotal_timeout: 30s\n---\n\n# The test document\n\nThe initial block that is initialized with `---` and terminated with `---` contains the configuration in YAML notation.\n\n## A simple test\n\n```scrut\n$ echo Hello One\nHello One\n```\n\nThe above test does not contain any per-test configuration\n\n## A test with configuration\n\n```scrut {timeout: 10s}\n$ echo Hello Two\nHello Two\n```\n\nThe above test contains per-test configuration\n")),(0,i.mdx)("p",null,"Some inline-configuration attribute can overwritten by parameters provided on the command-line. The order of precedence is:"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},"Command-line parameter"),(0,i.mdx)("li",{parentName:"ol"},"Per-TestCase configuration"),(0,i.mdx)("li",{parentName:"ol"},"Per-Document configuration"),(0,i.mdx)("li",{parentName:"ol"},"Default")),(0,i.mdx)("h4",{id:"document-configuration"},"Document Configuration"),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Name"),(0,i.mdx)("th",{parentName:"tr",align:null},"Type"),(0,i.mdx)("th",{parentName:"tr",align:null},"Corresponding Command Line Parameter"),(0,i.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"append")),(0,i.mdx)("td",{parentName:"tr",align:null},"list of strings"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--append-test-file-paths")),(0,i.mdx)("td",{parentName:"tr",align:null},"Include these paths in order, as if they were part of this file. All tests within the appended paths are appended to the tests defined in this file. Use-case is common/shared test tear-down. Paths must be relative to the current ",(0,i.mdx)("inlineCode",{parentName:"td"},"$TESTDIR"),".")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"defaults")),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"#testcase-configuration"},"TestCase Configuration")),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"Defaults for per-test-case configuration within the test file.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"prepend")),(0,i.mdx)("td",{parentName:"tr",align:null},"list of strings"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--prepend-test-file-paths")),(0,i.mdx)("td",{parentName:"tr",align:null},"Include these paths in order, as if they were part of this file. All tests within the prepend paths are prepended to the tests defined in this file. Use-case is common/shared test setup. Paths must be relative to the current ",(0,i.mdx)("inlineCode",{parentName:"td"},"$TESTDIR"),".")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"shell")),(0,i.mdx)("td",{parentName:"tr",align:null},"string"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--shell")),(0,i.mdx)("td",{parentName:"tr",align:null},"The path to the shell. If a full path is not provided, then the command must be in ",(0,i.mdx)("inlineCode",{parentName:"td"},"$PATH"),". ",(0,i.mdx)("strong",{parentName:"td"},"Only ",(0,i.mdx)("inlineCode",{parentName:"strong"},"bash")," compatible shells are currently supported!"))),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"total_timeout")),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://docs.rs/humantime/latest/humantime/"},"duration string")),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--timeout-seconds")),(0,i.mdx)("td",{parentName:"tr",align:null},"All tests within the file (including appended and prepended) must finish executing within this time.")))),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Defaults (Markdown and Cram)")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-yaml"},"append: []\ndefaults: {}\nprepend: []\nshell: bash\ntotal_timeout: 15m\n")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Caveats")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Per-document configuration in files that are appended or prepended is ignored")),(0,i.mdx)("h4",{id:"testcase-configuration"},"TestCase Configuration"),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Name"),(0,i.mdx)("th",{parentName:"tr",align:null},"Type"),(0,i.mdx)("th",{parentName:"tr",align:null},"Corresponding Command Line Parameter"),(0,i.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"detached")),(0,i.mdx)("td",{parentName:"tr",align:null},"boolean"),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"Tell Scrut that the shell expression of this test will detach itself, so Scrut will not consider this a test (i.e. no output or exit code evaluation). Purpose is to allow the user to detach a command (like ",(0,i.mdx)("inlineCode",{parentName:"td"},"nohup some-command &"),") that is doing something asynchronous (e.g. starting a server to which the tested CLI is a client).")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"environment")),(0,i.mdx)("td",{parentName:"tr",align:null},"object"),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"A set of environment variable names and values that will be explicitly set for the test.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"keep_crlf")),(0,i.mdx)("td",{parentName:"tr",align:null},"boolean"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--keep-output-crlf")),(0,i.mdx)("td",{parentName:"tr",align:null},"Whether CRLF should be translated to LF (=false) or whether CR needs to be explicitly handled (=true).")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"output_stream")),(0,i.mdx)("td",{parentName:"tr",align:null},"enum (",(0,i.mdx)("inlineCode",{parentName:"td"},"stdout"),", ",(0,i.mdx)("inlineCode",{parentName:"td"},"stderr"),", ",(0,i.mdx)("inlineCode",{parentName:"td"},"combined"),")"),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"--combine-output")," and ",(0,i.mdx)("inlineCode",{parentName:"td"},"--no-combine-output")),(0,i.mdx)("td",{parentName:"tr",align:null},"Which output stream to choose when applying output expectations: ",(0,i.mdx)("inlineCode",{parentName:"td"},"stdout")," (all expectations apply to what is printed on STDOUT), ",(0,i.mdx)("inlineCode",{parentName:"td"},"stderr")," (all expectations apply to what is printed on STDERR), ",(0,i.mdx)("inlineCode",{parentName:"td"},"combined")," (STDOUT and STDERR will combined into a single stream where all expectations are applied on)")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"skip_document_code")),(0,i.mdx)("td",{parentName:"tr",align:null},"positive integer"),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"The exit code, that if returned by any test, leads to skipping of the whole file.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"timeout")),(0,i.mdx)("td",{parentName:"tr",align:null},"null or ",(0,i.mdx)("a",{parentName:"td",href:"https://docs.rs/humantime/latest/humantime/"},"duration string")),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"A max execution time a test can run before it is considered failed (and will be aborted).")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"wait")),(0,i.mdx)("td",{parentName:"tr",align:null},"null or ",(0,i.mdx)("a",{parentName:"td",href:"https://docs.rs/humantime/latest/humantime/"},"duration string")," or ",(0,i.mdx)("a",{parentName:"td",href:"#wait-configuration"},"Wait Configuration")),(0,i.mdx)("td",{parentName:"tr",align:null},"n/a"),(0,i.mdx)("td",{parentName:"tr",align:null},"See ",(0,i.mdx)("a",{parentName:"td",href:"#wait-configuration"},"Wait Configuration"))))),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Defaults (Markdown)")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-yaml"},"detached: false\nenvironment: {}\nkeep_crlf: false\noutput_stream: stdout\nskip_document_code: 80\ntimeout: null\nwait: null\n")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Defaults (Cram)")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-yaml"},"detached: false\nenvironment: {}\nkeep_crlf: true\noutput_stream: combined\nskip_document_code: 80\ntimeout: null\nwait: null\n")),(0,i.mdx)("h3",{id:"wait-configuration"},"Wait Configuration"),(0,i.mdx)("p",null,"This configuration corresponds to the per-test-case ",(0,i.mdx)("inlineCode",{parentName:"p"},"detached")," configuration and helps to write client / server tests where first a server is started (i.e. a test that runs detached) and then a client communicates with the server (i.e. a test that waits)"),(0,i.mdx)("table",null,(0,i.mdx)("thead",{parentName:"table"},(0,i.mdx)("tr",{parentName:"thead"},(0,i.mdx)("th",{parentName:"tr",align:null},"Name"),(0,i.mdx)("th",{parentName:"tr",align:null},"Type"),(0,i.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,i.mdx)("tbody",{parentName:"table"},(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"timeout")),(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("a",{parentName:"td",href:"https://docs.rs/humantime/latest/humantime/"},"duration string")),(0,i.mdx)("td",{parentName:"tr",align:null},"How long to wait for the test to run.")),(0,i.mdx)("tr",{parentName:"tbody"},(0,i.mdx)("td",{parentName:"tr",align:null},(0,i.mdx)("inlineCode",{parentName:"td"},"path")),(0,i.mdx)("td",{parentName:"tr",align:null},"null or string"),(0,i.mdx)("td",{parentName:"tr",align:null},"If set then the wait will end early once the path exists. This path must be in ",(0,i.mdx)("inlineCode",{parentName:"td"},"$TMPDIR"))))),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Example")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-markdown"},'# A server/client test example\n\nShow-case how a server/client test that initially starts a server\n\n## Start a server\n\n```scrut {detached: true}\n$ my-server --start && touch "$TMPDIR"/server-started\n```\n\n## Run client test once server is up\n\n```scrut {wait: {timeout: 5m, path: server-started}}\n$ my-client --do-a-thing\n```\n')),(0,i.mdx)("h2",{id:"cram-format"},"Cram Format"),(0,i.mdx)("p",null,"Also supported, for compatibility, is the Cram file format. The general guidance to write ",(0,i.mdx)("em",{parentName:"p"},"Test Cases")," in Cram files is:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"The first line of ",(0,i.mdx)("em",{parentName:"li"},"Shell Expression")," must start with ",(0,i.mdx)("inlineCode",{parentName:"li"}," $")," (space + space + dollar + space), any subsequent with ",(0,i.mdx)("inlineCode",{parentName:"li"}," >")," (space + space + closing angle bracket + space)",(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},"This is slightly different from classic scrut syntax. Be mindful of the additional spaces"))),(0,i.mdx)("li",{parentName:"ul"},"Lines following the ",(0,i.mdx)("em",{parentName:"li"},"Shell Expression"),", that are also indented with two spaces, are considered ",(0,i.mdx)("em",{parentName:"li"},"Expectations"),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},"If an Exit Code other than 0 is expected, it can be denoted in square brackets ",(0,i.mdx)("inlineCode",{parentName:"li"}," [123]")," once per Test Case"),(0,i.mdx)("li",{parentName:"ul"},"Note: Empty output lines (=empty ",(0,i.mdx)("em",{parentName:"li"},"Expectations"),") must still have two leading space characters"),(0,i.mdx)("li",{parentName:"ul"},"Note: A fully empty line (no leading spaces) denotes the end of the current ",(0,i.mdx)("em",{parentName:"li"},"Test Case")))),(0,i.mdx)("li",{parentName:"ul"},"If the ",(0,i.mdx)("em",{parentName:"li"},"Shell Expression")," is preceded by a non-empty line (that is ",(0,i.mdx)("em",{parentName:"li"},"not")," indented) the line is considered the ",(0,i.mdx)("em",{parentName:"li"},"Title")," of the ",(0,i.mdx)("em",{parentName:"li"},"Test Case"))),(0,i.mdx)("p",null,"Here an example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-cram"},"This is a comment\n  $ scrut --help\n  Scrut help output\n\nAnother Test Case in the same file\n  $ scrut --version\n  Scrut version output\n")),(0,i.mdx)("p",null,"Multiple tests Test Cases can be written in sequence, without any empty lines in between:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-cram"},"A title for the first Test Case\n  $ first --command\n  $ second --command\n  $ third --comand\n  Output Expectation\n")),(0,i.mdx)("blockquote",null,(0,i.mdx)("p",{parentName:"blockquote"},(0,i.mdx)("strong",{parentName:"p"},"Note"),": Remember the indenting space characters!")),(0,i.mdx)("h2",{id:"which-format-to-chose"},"Which format to chose?"),(0,i.mdx)("p",null,"We recommend the Markdown format which was introduced with two goals in mind:"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("strong",{parentName:"li"},"Tests \u2764\ufe0f Documentation"),": The value of tests is not only in proving behavior, but also in documenting it - and thereby also in teaching it. The Markdown Test Case format allows you to keep tests around in a way that future generations of maintainers will love you for."),(0,i.mdx)("li",{parentName:"ol"},(0,i.mdx)("strong",{parentName:"li"},"Bad Spaces \ud83d\udc7e"),": To denote an expected empty line of output in Cram format you have to provide two empty spaces ",(0,i.mdx)("inlineCode",{parentName:"li"}," "),". This goes counter a lot of default behavior in the development toolchain. Many CI/CD tools are tuned to automatically ignore changes that only pertain spaces. Code review tools often deliberately hide those changes. Spaces are generally hard to see in code editors - if they are visualized at all. Breaking tests that are caused by an accidentally removed or added space cause rage quitting.")),(0,i.mdx)("p",null,"If these arguments resonate with you, go for the Markdown format. If not you are probably better of with Cram that allows for a more condensed writing style. Choices, choices."))}c.isMDXComponent=!0}}]);